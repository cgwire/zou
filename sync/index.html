<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="CGWire" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Data migration - Kitsu API Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Data migration";
        var mkdocs_page_input_path = "sync.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Kitsu API Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../backup/">Backup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../configuration/">Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../development/">Development environment</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../events/">Events</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../file_trees/">File trees descriptors</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../indexer/">Data indexation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../jobs/">Job Queue</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ldap/">LDAP</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../log_rotation/">Log rotation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../plugin/">Plugins</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Data migration</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#raw-mode">Raw mode</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#with-zou-cli">With Zou CLI</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#prepare-the-new-instance-reset-data">Prepare the new instance (reset data)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get-data">Get data</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get-files">Get files</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Kitsu API Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Data migration</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/cgwire/zou/edit/docs/docs/sync.md">Edit on Zou</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="data-migration">Data migration</h1>
<h2 id="raw-mode">Raw mode</h2>
<p>To migrate a Kitsu from an instance to another, you can simply dump the
database and restore it to the new instance. Once done, you have to move all 
the files stored in the preview folder to the preview folder of the new
instance.</p>
<h2 id="with-zou-cli">With Zou CLI</h2>
<p>We assume here that you are evolving in the zou virtualenv environment and that
all your environment variables are loaded.</p>
<h3 id="prepare-the-new-instance-reset-data">Prepare the new instance (reset data)</h3>
<p>Clear original database and rebuild tables:</p>
<pre><code>. /etc/zou/zou.env
zou clear-db
zou reset-migrations
zou upgrade-db
</code></pre>
<h3 id="get-data">Get data</h3>
<p>Retrieve base data:</p>
<pre><code>. /etc/zou/zou.env
SYNC_LOGIN=&quot;admin@yourstudio.com&quot; \
SYNC_PASSWORD=&quot;password&quot; \
zou sync-full --source http://yourpreviouskitsu.url/api --no-projects
</code></pre>
<p>Retrieve project data:</p>
<pre><code>. /etc/zou/zou.env
SYNC_LOGIN=&quot;admin@yourstudio.com&quot; \
SYNC_PASSWORD=&quot;password&quot; \
zou sync-full --source http://yourpreviouskitsu.url/api --only-projects
</code></pre>
<p>Retrieve a given project:</p>
<pre><code>. /etc/zou/zou.env
SYNC_LOGIN=&quot;admin@yourstudio.com&quot; \
SYNC_PASSWORD=&quot;password&quot; \
zou sync-full --source http://yourpreviouskitsu.url/api --project AwesomeProject
</code></pre>
<p>If some changes occured after the migration, you can run the command again and
retrieve the difference. Beware that deletion won't be handled.</p>
<h3 id="get-files">Get files</h3>
<p>The previous steps were used to retrieve the data stored in the database.</p>
<p>Retrieve all files:</p>
<pre><code>. /etc/zou/zou.env
SYNC_LOGIN=&quot;admin@yourstudio.com&quot; \
SYNC_PASSWORD=&quot;password&quot; \
zou sync-full-files --source http://yourpreviouskitsu.url/api
</code></pre>
<p>Retrieve files for a given project:</p>
<pre><code>. /etc/zou/zou.env
SYNC_LOGIN=&quot;admin@yourstudio.com&quot; \
SYNC_PASSWORD=&quot;password&quot; \
zou sync-full-files --source http://yourpreviouskitsu.url/api
</code></pre>
<p>If some changes occured after the migration, you can run the command again and
retrieve the difference. Beware that deletion won't be handled.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../plugin/" class="btn btn-neutral float-left" title="Plugins"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../troubleshooting/" class="btn btn-neutral float-right" title="Troubleshooting">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/cgwire/zou/" class="fa fa-code-fork" style="color: #fcfcfc"> Zou</a>
        </span>
    
    
      <span><a href="../plugin/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../troubleshooting/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
